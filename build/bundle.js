module.exports=function(t){function e(r){if(n[r])return n[r].exports;var s=n[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=14)}([function(t,e,n){"use strict";t.exports=n(3).config()},function(t,e){t.exports=require("auth0-extension-express-tools@1.1.5")},function(t,e,n){"use strict";var r=n(20);r.emitErrs=!0;var s=new r.Logger({transports:[new r.transports.Console({timestamp:!0,level:"debug",handleExceptions:!0,json:!1,colorize:!0})],exitOnError:!1});t.exports=s,t.exports.stream={write:function(t){s.info(t.replace(/\n$/,""))}}},function(t,e){t.exports=require("auth0-extension-tools@1.3.1")},function(t,e){t.exports=require("bluebird")},function(t,e){t.exports=require("express")},function(t,e){t.exports=require("lodash")},function(t,e){t.exports=require("superagent")},function(t,e,n){"use strict";(function(e){var r=n(19),s=n(5),o=n(16),i=n(1),u=n(3),c=n(2),a=n(0),p=n(15),d=n(10),f=n(9);t.exports=function(t,n){a.setProvider(t);var h=n?new u.WebtaskStorageContext(n,{force:1}):new u.FileStorageContext(r.join(e,"./data.json"),{mergeWrites:!0}),l=s();return l.use("/app",s.static(r.join(e,"../build"))),l.use(o.json()),l.use(o.urlencoded({extended:!1})),l.use("/meta",function(t,e){e.status(200).send(p)}),l.use(i.routes.dashboardAdmins({secret:a("EXTENSION_SECRET"),audience:"urn:user-import-export-extension",rta:a("AUTH0_RTA").replace("https://",""),domain:a("AUTH0_DOMAIN"),baseUrl:a("WT_URL"),clientName:"User Import / Export Extension",urlPrefix:"",sessionStorageKey:"user-import-export-extension:apiToken",scopes:"create:users read:users read:connections create:passwords_checking_job"})),l.use("/api",f(h)),l.get("*",d()),l.use(i.middlewares.errorHandler(c.error.bind(c))),l}}).call(e,"/")},function(t,e,n){"use strict";var r=(n(6),n(5)),s=n(18),o=n(1).middlewares,i=n(0),u=n(13),c=n(12);t.exports=function(t){var e=r.Router();return e.use(o.authenticateAdmins({credentialsRequired:!0,secret:i("EXTENSION_SECRET"),audience:"urn:user-import-export-extension",baseUrl:i("WT_URL"),onLoginSuccess:function(t,e,n){n()}})),e.post("/jobs/import",function(e,n,r){var o=new s.IncomingForm;o.keepExtensions=!0,o.parse(e,function(s,o,i){if(s)return r(s);c.usersImport(o.connection_id,i.users,t,e.user.access_token).then(function(t){return n.json(t)}).catch(r)})}),e.post("/jobs/export",function(e,n,r){c.usersExport(e.body,t,e.user.access_token).then(function(t){return n.json(t)}).catch(r)}),e.get("/jobs/:id",function(e,n,r){c.check(e.params.id,t,e.user.access_token).then(function(t){return n.json(t)}).catch(r)}),e.get("/jobs/:id/report",function(t,e,n){c.report(t.params.id,t.user.access_token).then(function(t){return e.json(t)}).catch(n)}),e.get("/connections",function(t,e,n){u.getConnections(t.query.strategy||null,t.user.access_token).then(function(t){return e.json(t)}).catch(n)}),e.get("/users",function(t,e,n){u.getUsersCount(t.query.connection||null,t.user.access_token).then(function(t){return e.json(t)}).catch(n)}),e.get("/history",function(e,n,r){t.read().then(function(t){return n.json(t)}).catch(r)}),e}},function(t,e,n){"use strict";var r=n(17),s=n(0),o=n(1).urlHelpers;t.exports=function(){var t='\n    <!DOCTYPE html>\n    <html lang="en">\n    <head>\n      <title>User Import / Export Dashboard</title>\n      <meta charset="UTF-8" />\n      <meta http-equiv="X-UA-Compatible" content="IE=Edge" />\n      <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n      <link rel="shortcut icon" href="https://cdn.auth0.com/styleguide/2.0.1/lib/logos/img/favicon.png">\n      <meta name="viewport" content="width=device-width, initial-scale=1">\n      <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/styles/zocial.min.css">\n      <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/manage/v0.3.973/css/index.min.css">\n      <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/styleguide/3.8.4/index.css">\n      <% if (assets.version) { %>\n        <link rel="stylesheet" type="text/css" href="//cdn.auth0.com/extensions/auth0-user-import-export/assets/auth0-user-import-export.ui.<%= assets.version %>.css">\n      <% } %>\n    </head>\n    <body>\n      <div id="app"></div>\n      <script type="text/javascript">window.config = <%- JSON.stringify(config) %>;<\/script>\n      <script type="text/javascript" src="//cdn.auth0.com/manage/v0.3.973/components/ZeroClipboard/ZeroClipboard.js"><\/script>\n      <script type="text/javascript" src="//cdn.auth0.com/manage/v0.3.973/js/bundle.js"><\/script>\n      <% if (assets.app) { %><script type="text/javascript" src="<%= assets.app %>"><\/script><% } %>\n      <% if (assets.version) { %>\n      <script type="text/javascript" src="//cdn.auth0.com/extensions/auth0-user-import-export/assets/auth0-user-import-export.ui.vendors.<%= assets.version %>.js"><\/script>\n      <script type="text/javascript" src="//cdn.auth0.com/extensions/auth0-user-import-export/assets/auth0-user-import-export.ui.<%= assets.version %>.js"><\/script>\n      <% } %>\n    </body>\n    </html>\n  ';return function(e,n){var i={HOSTING_ENV:s("HOSTING_ENV"),CLIENT_VERSION:"2.4.0",AUTH0_DOMAIN:s("AUTH0_DOMAIN"),BASE_URL:o.getBaseUrl(e),BASE_PATH:o.getBasePath(e)};0!==i.BASE_PATH.indexOf("/")&&(i.BASE_PATH="/"+i.BASE_PATH);return n.send(r.render(t,{config:i,assets:{version:"2.4.0"}}))}}},function(t,e,n){"use strict";var r=n(6);t.exports=function(t,e){return e.read().then(function(n){n=n||{},n.jobs=n.jobs||[];var s={id:t.id,type:t.type,date:t.date||new Date,status:t.status||"pending",summary:t.summary||{}},o=r.findIndex(n.jobs,{id:s.id});return o<0?n.jobs.push(s):(n.jobs[o].status=s.status,n.jobs[o].summary=s.summary),n.jobs.length>20&&(n.jobs=r.drop(n.jobs,n.jobs.length-20)),e.write(n).then(function(){return t})})}},function(t,e,n){"use strict";var r=n(4),s=n(7),o=n(11),i=n(0);t.exports={usersImport:function(t,e,n,u){var c="https://"+i("AUTH0_DOMAIN")+"/api/v2/jobs/users-imports";return new r(function(r,i){s.post(c).set("accept","json").set("Authorization","Bearer "+u).field("connection_id",t).attach("users",e.path).end(function(t,e){if(t||!e)return i(t||"Unknown error");if(e.status>=300)return i(e.error||e.body||e);var s={id:e.body.id,type:"import"};return o(s,n).then(function(){return r(e.body)})})})},usersExport:function(t,e,n){var u="https://"+i("AUTH0_DOMAIN")+"/api/v2/jobs/users-exports";return new r(function(r,i){s.post(u).send(t).set("accept","json").set("Authorization","Bearer "+n).end(function(t,n){if(t||!n)return i(t||"Unknown error");if(n.status>=300)return i(n.error||n.body||n);var s={id:n.body.id,type:"export"};return o(s,e).then(function(){return r(n.body)})})})},check:function(t,e,n){var u="https://"+i("AUTH0_DOMAIN")+"/api/v2/jobs/"+t;return new r(function(r,i){s.get(u).set("accept","json").set("Authorization","Bearer "+n).end(function(n,s){if(n||!s)return i(n||"Unknown error");if(s.status>=300)return i(s.error||s.body||s);var u={id:t,status:s.body.status,summary:s.body.summary};return o(u,e).then(function(){return r(s.body)})})})},report:function(t,e){var n="https://"+i("AUTH0_DOMAIN")+"/api/v2/jobs/"+t+"/errors";return new r(function(t,r){s.get(n).set("accept","json").set("Authorization","Bearer "+e).end(function(e,n){return e||!n?r(e||"Unknown error"):n.status>=300?r(n.error||n.body||n):t(204===n.status?["Failed to parse users file when importing users."]:n.body)})})}}},function(t,e,n){"use strict";var r=n(4),s=n(7),o=n(0),i=function(t,e){return new r(function(n,r){s.get(t).set("accept","json").set("Authorization","Bearer "+e).end(function(t,e){return t?r(t):e.status>=200&&e.status<=300?n(e.body):r(e&&e.error||e)})})},u=function(t,e){var n=[],s="https://"+o("AUTH0_DOMAIN")+"/api/v2/connections",u=0,c=0,a="?per_page=100";t&&(a+="&strategy=auth0");var p=function(){return i(""+s+a+"&page=0&include_totals=true",e).then(function(t){return u=t.total||0,c=Math.ceil(u/100),(t.connections||t||[]).forEach(function(t){return n.push(t)}),null})},d=function(t){return i(""+s+a+"&page="+t,e).then(function(t){return t.forEach(function(t){return n.push(t)}),null})};return function(){return p().then(function(){if(0===u||n.length>=u)return n;for(var t=[],e=1;e<=c;e++)t.push(e);return r.map(t,d,{concurrency:5})})}().then(function(){return n})};t.exports={getUsersCount:function(t,e){var n="https://"+o("AUTH0_DOMAIN")+"/api/v2/users?per_page=1&page=0&include_totals=true&search_engine=v2";return t&&(n+='&q=identities.connection:"'+t+'"'),i(n,e)},getConnections:u}},function(t,e,n){"use strict";var r=n(1),s=n(8),o=n(0),i=n(2),u=r.createServer(function(t,e){return i.info("Starting User Import/Export Extension - Version:","2.4.0"),s(t,e)});t.exports=function(t,e,n){o.setValue("PUBLIC_WT_URL",r.urlHelpers.getWebtaskUrl(e)),u(t,e,n)}},function(t,e){t.exports={title:"User Import / Export",name:"auth0-user-import-export",version:"2.4.0",author:"auth0",useHashName:!1,description:"This extension allows you to import/export users from/to your account.",type:"application",logoUrl:"https://cdn.rawgit.com/auth0/auth0-user-import-export-extension/master/assets/logo.svg",initialUrlPath:"/login",docsUrl:"https://auth0.com/docs/extensions/user-import-export",repository:"https://github.com/auth0/auth0-user-import-export-extension",keywords:["auth0","extension"],auth0:{scopes:"create:users read:users read:connections create:passwords_checking_job"}}},function(t,e){t.exports=require("body-parser")},function(t,e){t.exports=require("ejs")},function(t,e){t.exports=require("formidable")},function(t,e){t.exports=require("path")},function(t,e){t.exports=require("winston")}]);