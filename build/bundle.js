module.exports=function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";var n=r(9),o=r(4),i=r(41);e.exports=o.createExpressServer(function(e,t){return console.log("Starting User Import/Export Extension - Version:",t("CLIENT_VERSION")),n.env().argv().overrides({AUTH0_DOMAIN:e.webtaskContext.secrets.AUTH0_DOMAIN,AUTH0_SCOPES:e.webtaskContext.secrets.AUTH0_SCOPES,NODE_ENV:"production",HOSTING_ENV:"webtask",CLIENT_VERSION:t("CLIENT_VERSION")}),i()})},function(e,t,r){e.exports.ArgumentError=r(28),e.exports.HookTokenError=r(29),e.exports.ManagementApiError=r(30),e.exports.NotFoundError=r(31),e.exports.ValidationError=r(32)},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("lodash")},function(e,t,r){const n=r(13),o=r(1),i=r(37),a=e.exports={};a.ArgumentError=o.ArgumentError,a.HookTokenError=o.HookTokenError,a.ManagementApiError=o.ManagementApiError,a.NotFoundError=o.NotFoundError,a.ValidationError=o.ValidationError,a.managementApi=r(26),a.FileStorageContext=i.FileStorageContext,a.WebtaskStorageContext=i.WebtaskStorageContext,a.BlobRecordProvider=r(34),a.config=r(27),a.configProvider=r(12),a.createServer=r(35).createServer,a.validateHookToken=r(33),a.createExpressServer=function(e){return n.fromExpress(a.createServer(e))},a.createHapiServer=function(e){return n.fromHapi(a.createServer(e))}},function(e,t,r){var n=r(57),o=r(46),i={};t.wrap=function(e,t,r){return o.assert(e instanceof Error,"Cannot wrap non-Error object"),e.isBoom?e:i.initialize(e,t||500,r)},t.create=function(e,r,n){return i.create(e,r,n,t.create)},i.create=function(e,t,r,n){var o=new Error(t?t:void 0);return Error.captureStackTrace(o,n),o.data=r||null,i.initialize(o,e),o},i.initialize=function(e,t,r){var n=parseInt(t,10);return o.assert(!isNaN(n)&&n>=400,"First argument must be a number (400+):",t),e.isBoom=!0,e.isServer=n>=500,e.hasOwnProperty("data")||(e.data=null),e.output={statusCode:n,payload:{},headers:{}},e.reformat=i.reformat,e.reformat(),r||e.message||(r=e.output.payload.error),r&&(e.message=r+(e.message?": "+e.message:"")),e},i.reformat=function(){this.output.payload.statusCode=this.output.statusCode,this.output.payload.error=n.STATUS_CODES[this.output.statusCode]||"Unknown",500===this.output.statusCode?this.output.payload.message="An internal server error occurred":this.message&&(this.output.payload.message=this.message)},t.badRequest=function(e,r){return i.create(400,e,r,t.badRequest)},t.unauthorized=function(e,r,n){var a=i.create(401,e,void 0,t.unauthorized);if(!r)return a;var s="",c=0,u=0;if("string"==typeof r){if(s=r,(n||e)&&(a.output.payload.attributes={}),n){var p=Object.keys(n);for(c=0,u=p.length;c<u;++c){var f=p[c];c&&(s+=",");var l=n[f];null!==l&&void 0!==l||(l=""),s+=" "+f+'="'+o.escapeHeaderAttribute(l.toString())+'"',a.output.payload.attributes[f]=l}}e?(n&&(s+=","),s+=' error="'+o.escapeHeaderAttribute(e)+'"',a.output.payload.attributes.error=e):a.isMissing=!0}else{var d=r;for(c=0,u=d.length;c<u;++c)c&&(s+=", "),s+=d[c]}return a.output.headers["WWW-Authenticate"]=s,a},t.forbidden=function(e,r){return i.create(403,e,r,t.forbidden)},t.notFound=function(e,r){return i.create(404,e,r,t.notFound)},t.methodNotAllowed=function(e,r){return i.create(405,e,r,t.methodNotAllowed)},t.notAcceptable=function(e,r){return i.create(406,e,r,t.notAcceptable)},t.proxyAuthRequired=function(e,r){return i.create(407,e,r,t.proxyAuthRequired)},t.clientTimeout=function(e,r){return i.create(408,e,r,t.clientTimeout)},t.conflict=function(e,r){return i.create(409,e,r,t.conflict)},t.resourceGone=function(e,r){return i.create(410,e,r,t.resourceGone)},t.lengthRequired=function(e,r){return i.create(411,e,r,t.lengthRequired)},t.preconditionFailed=function(e,r){return i.create(412,e,r,t.preconditionFailed)},t.entityTooLarge=function(e,r){return i.create(413,e,r,t.entityTooLarge)},t.uriTooLong=function(e,r){return i.create(414,e,r,t.uriTooLong)},t.unsupportedMediaType=function(e,r){return i.create(415,e,r,t.unsupportedMediaType)},t.rangeNotSatisfiable=function(e,r){return i.create(416,e,r,t.rangeNotSatisfiable)},t.expectationFailed=function(e,r){return i.create(417,e,r,t.expectationFailed)},t.badData=function(e,r){return i.create(422,e,r,t.badData)},t.preconditionRequired=function(e,r){return i.create(428,e,r,t.preconditionRequired)},t.tooManyRequests=function(e,r){return i.create(429,e,r,t.tooManyRequests)},t.internal=function(e,r,n){return i.serverError(e,r,n,t.internal)},i.serverError=function(e,r,n,o){var a;return r instanceof Error?a=t.wrap(r,n,e):(a=i.create(n||500,e,void 0,o),a.data=r),a},t.notImplemented=function(e,r){return i.serverError(e,r,501,t.notImplemented)},t.badGateway=function(e,r){return i.serverError(e,r,502,t.badGateway)},t.serverTimeout=function(e,r){return i.serverError(e,r,503,t.serverTimeout)},t.gatewayTimeout=function(e,r){return i.serverError(e,r,504,t.gatewayTimeout)},t.badImplementation=function(e,r){var n=i.serverError(e,r,500,t.badImplementation);return n.isDeveloperError=!0,n}},function(e,t){e.exports=function(e,t){t.writeHead(e.code||500,{"Content-Type":"application/json","Cache-Control":"no-cache"}),t.end(JSON.stringify(e))}},function(e,t){e.exports=require("request")},function(e,t){e.exports=require("bluebird")},function(e,t){e.exports=require("nconf")},function(e,t){e.exports=require("superagent")},function(e,t){e.exports=require("url")},function(e,t,r){const n=r(3),o=r(1).ArgumentError;e.exports.fromWebtaskContext=function(e){if(null===e||void 0===e)throw new o("Must provide a webtask context");const t=n.assign({},{NODE_ENV:"production",CLIENT_VERSION:"1.4.2"},e.params,e.secrets,{NODE_ENV:"production",HOSTING_ENV:"webtask"});return function(e){return t[e]}}},function(e,t,r){function n(e){return e.auth0=function(r){return t.auth0(e,r)},e}function o(e){return n(function(t,r,n){var o=s(r.x_wt.jtn);return r.originalUrl=r.url,r.url=r.url.replace(o,"/"),r.webtaskContext=c(t),e(r,n)})}function i(e){var t;return e.ext("onRequest",function(e,r){var n=s(e.x_wt.jtn);e.setUrl(e.url.replace(n,"/")),e.webtaskContext=t}),n(function(r,n,o){var i=e._dispatch();t=c(r),i(n,o)})}function a(e){return n(function(t,r,n){var o=s(r.x_wt.jtn);return r.originalUrl=r.url,r.url=r.url.replace(o,"/"),r.webtaskContext=c(t),e.emit("request",r,n)})}function s(e){var t="^/api/run/[^/]+/",r="(?:[^/?#]*/?)?";return new RegExp(t+(e?r:""))}function c(e){function t(e,t,n){var o=r(5);"function"==typeof t&&(n=t,t={}),n(o.preconditionFailed("Storage is not available in this context"))}function n(t,n,o){var i=r(5),a=r(7);"function"==typeof n&&(o=n,n={}),a({uri:e.secrets.EXT_STORAGE_URL,method:"GET",headers:n.headers||{},qs:{path:t},json:!0},function(e,t,r){return e?o(i.wrap(e,502)):404===t.statusCode&&Object.hasOwnProperty.call(n,"defaultValue")?o(null,n.defaultValue):t.statusCode>=400?o(i.create(t.statusCode,r&&r.message)):void o(null,r)})}function o(e,t,n,o){var i=r(5);"function"==typeof n&&(o=n,n={}),o(i.preconditionFailed("Storage is not available in this context"))}function i(t,n,o,i){var a=r(5),s=r(7);"function"==typeof o&&(i=o,o={}),s({uri:e.secrets.EXT_STORAGE_URL,method:"PUT",headers:o.headers||{},qs:{path:t},body:n},function(e,t,r){return e?i(a.wrap(e,502)):t.statusCode>=400?i(a.create(t.statusCode,r&&r.message)):void i(null)})}return e.read=e.secrets.EXT_STORAGE_URL?n:t,e.write=e.secrets.EXT_STORAGE_URL?i:o,e}t.auth0=r(50),t.fromConnect=t.fromExpress=o,t.fromHapi=i,t.fromServer=t.fromRestify=a},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("lru-cache")},function(e,t){e.exports=require("path")},function(e,t,r){function n(e){return e=e.match(/.{1,64}/g).join("\n"),e="-----BEGIN CERTIFICATE-----\n"+e,e+="\n-----END CERTIFICATE-----\n"}var o=r(17),i=r(7),a=r(3),s={max:5242880,length:function(e){return e.length},maxAge:3e5},c=o(s);e.exports=function(e){return e=e||{},e.strictSSL="undefined"==typeof e.strictSSL||e.strictSSL,function(t,r,o,s){var u=o.iss+"|"+o.aud,p=c.get(u);if(p)return s(null,p);switch(r.alg){case"RS256":var f=o.iss+".well-known/jwks.json";i.get(f,{json:!0,strictSSL:e.strictSSL},function(e,t,i){if(e)return s(e);if(200!==t.statusCode)return s(new Error("Failed to obtain JWKS from "+o.iss));var p=a.find(i.keys,function(e){return e.kid==r.kid});if(!p)return s(new Error("Failed to obtain signing key used by "+o.iss));var f=n(p.x5c[0]);return c.set(u,f),s(null,f)});break;default:return s(new Error("Unsupported JWT algorithm: "+r.alg))}}}},function(e,t,r){const n=r(24),o=r(25),i=r(21);e.exports.createServer=n.createServer,e.exports.urlHelpers=o,e.exports.middlewares=i},function(e,t,r){e.exports.managementApiClient=r(22),e.exports.validateHookToken=r(23)},function(e,t,r){const n=r(4);e.exports=function(e){return function(t,r,o){const i=t;n.managementApi.getClient(e).then(function(e){i.auth0=e,o()})["catch"](function(e){o(e)})}}},function(e,t,r){const n=r(4);e.exports=function(e,t,r){if(null===e||void 0===e)throw new n.ArgumentError("Must provide the domain");if("string"!=typeof e||0===e.length)throw new n.ArgumentError("The provided domain is invalid: "+e);if(null===t||void 0===t)throw new n.ArgumentError("Must provide the webtaskUrl");if("string"!=typeof t||0===t.length)throw new n.ArgumentError("The provided webtaskUrl is invalid: "+t);if(null===r||void 0===r)throw new n.ArgumentError("Must provide the extensionSecret");if("string"!=typeof r||0===r.length)throw new n.ArgumentError("The provided extensionSecret is invalid: "+r);return function(o){if(null===o||void 0===o)throw new n.ArgumentError("Must provide the hookPath");if("string"!=typeof o||0===o.length)throw new n.ArgumentError("The provided hookPath is invalid: "+o);return function(i,a,s){if(i.headers.authorization&&"Bearer"===i.headers.authorization.split(" ")[0]){const c=i.headers.authorization.split(" ")[1];try{if(n.validateHookToken(e,t,o,r,c))return s()}catch(u){return s(u)}}return s(new n.HookTokenError("Hook token missing for the call to: "+o))}}}},function(e,t,r){const n=r(4),o=r(13);e.exports.createServer=function(e){return o.fromExpress(n.createServer(e))}},function(e,t,r){const n=r(11),o=function(e,t){var r=n.parse(e).pathname||"";return r=r.replace(t,"").replace(/^\/|\/$/g,""),r.startsWith("/")||(r="/"+r),r.endsWith("/")||(r+="/"),r};e.exports.getBasePath=function(e){return o(e.originalUrl||"",e.path)},e.exports.getBaseUrl=function(e){const t=n.parse(e.originalUrl||"").pathname||"";return n.format({protocol:"https",host:e.get("host"),pathname:t.replace(e.path,"")})}},function(e,t,r){const n=r(59),o=r(2),i=r(53),a=r(8),s=r(48),c=r(10),u=r(1).ArgumentError,p=r(1).ManagementApiError,f=function(e,t,r){return new a(function(n,o){c.post("https://"+e+"/oauth/token").send({audience:"https://"+e+"/api/v2/",client_id:t,client_secret:r,grant_type:"client_credentials"}).set("Accept","application/json").end(function(e,r){return e&&401===e.status?o(new p("unauthorized","Invalid credentials for "+t,e.status)):e&&r&&r.body&&r.body.error?o(new p(r.body.error,r.body.error_description||r.body.error,e.status)):e?o(e):r.ok&&r.body.access_token?n(r.body.access_token):o(new p("unknown_error","Unknown error from Management Api or no access token was provided: "+(r.text||r.status)))})})},l=a.promisify(s({load:function(e,t,r,n){f(e,t,r).then(function(e){return n(null,e)})["catch"](function(e){return n(e)})},hash:function(e,t,r){return e+"-"+t+"-"+r},itemMaxAge:function(e,t,r,n){try{const i=o.decode(n),a=new Date(0);a.setUTCSeconds(i.exp);const s=(new Date).valueOf();return a.valueOf()-s-1e4}catch(c){return 1e3}},max:100,maxAge:n("1h")}));e.exports.getAccessToken=f,e.exports.getAccessTokenCached=l,e.exports.getClient=function(e){if(null===e||void 0===e)throw new u("An options object must be provided");if(null===e.domain||void 0===e.domain)throw new u("An options object must contain the domain");if("string"!=typeof e.domain||0===e.domain.length)throw new u("The provided domain is invalid: "+e.domain);if(e.accessToken){if("string"!=typeof e.accessToken||0===e.accessToken.length)throw new u("The provided accessToken is invalid");return a.resolve(new i.ManagementClient({domain:e.domain,token:e.accessToken}))}if(null===e.clientId||void 0===e.clientId)throw new u("An options object must contain the clientId");if("string"!=typeof e.clientId||0===e.clientId.length)throw new u("The provided clientId is invalid: "+e.clientId);if(null===e.clientSecret||void 0===e.clientSecret)throw new u("An options object must contain the clientSecret");if("string"!=typeof e.clientSecret||0===e.clientSecret.length)throw new u("The provided clientSecret is invalid");return l(e.domain,e.clientId,e.clientSecret).then(function(t){return new i.ManagementClient({domain:e.domain,token:t})})}},function(e,t){e.exports=function(){var e=null;const t=function(t){if(!e)throw new Error("A configuration provider has not been set");return e(t)};return t.setProvider=function(t){e=t},t}},function(e,t){function r(e){Error.call(this,e),Error.captureStackTrace(this,this.constructor),this.name="ArgumentError",this.message=e,this.status=400}r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,e.exports=r},function(e,t){function r(e,t){Error.call(this,e),Error.captureStackTrace(this,this.constructor),this.name="HookTokenError",this.message=e,this.status=401,this.innerError=t}r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,e.exports=r},function(e,t){function r(e,t,r){Error.call(this,t),Error.captureStackTrace(this,this.constructor),this.name="ManagementApiError",this.code=e,this.message=t,this.status=r||400}r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,e.exports=r},function(e,t){function r(e){Error.call(this,e),Error.captureStackTrace(this,this.constructor),this.name="NotFoundError",this.message=e,this.status=404}r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,e.exports=r},function(e,t){function r(e){Error.call(this,e),Error.captureStackTrace(this,this.constructor),this.name="ValidationError",this.message=e,this.status=400}r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,e.exports=r},function(e,t,r){const n=r(2),o=r(1).HookTokenError;e.exports=function(e,t,r,i,a){if(!a)throw new o("Hook token missing");try{return n.verify(a,i,{audience:t+r,issuer:"https://"+e}),!0}catch(s){throw new o("Invalid hook token",s)}}},function(e,t,r){function n(e){if(null===e||void 0===e)throw new a("Must provide a storage context");this.storageContext=e}const o=r(3),i=r(60),a=r(1).ArgumentError,s=r(1).NotFoundError,c=r(1).ValidationError,u=function(e,t){return e.read(t).then(function(e){return e[t]=e[t]||[],e})};n.prototype.getAll=function(e){return u(this.storageContext,e).then(function(t){return t[e]})},n.prototype.get=function(e,t){return this.getAll(e).then(function(r){const n=o.find(r,function(e){return e._id===t});return n?n:Promise.reject(new s("The record "+t+" in "+e+" does not exist."))})},n.prototype.create=function(e,t){const r=this.storageContext;return u(r,e).then(function(n){t._id||(t._id=i.v4());const a=o.findIndex(n[e],function(e){return e._id===t._id});return a>-1?Promise.reject(new c("The record "+t._id+" in "+e+" already exists.")):(n[e].push(t),r.write(n).then(function(){return t}))})},n.prototype.update=function(e,t,r,n){const i=this.storageContext;return u(i,e).then(function(a){const c=o.findIndex(a[e],function(e){return e._id===t});if(c<0&&!n)throw new s("The record "+t+" in "+e+" does not exist.");const u=o.extend({_id:t},c<0?{}:a[e][c],r);return c<0?a[e].push(u):a[e][c]=u,i.write(a).then(function(){return u})})},n.prototype["delete"]=function(e,t){const r=this.storageContext;return u(r,e).then(function(n){const i=o.findIndex(n[e],function(e){return e._id===t});return!(i<0)&&(n[e].splice(i,1),r.write(n).then(function(){return!0}))})},e.exports=n},function(e,t,r){const n=r(12);e.exports.createServer=function(e){var t=null;return function(r,o){if(!t){const i=n.fromWebtaskContext(r.webtaskContext);t=e(r,i,r.webtaskContext.storage)}return t(r,o)}}},function(e,t,r){function n(e,t){if(null===e||void 0===e)throw new s("Must provide the path to the file");if("string"!=typeof e||0===e.length)throw new s("The provided path is invalid: "+e);t=t||{mergeWrites:!0},this.path=e,this.mergeWrites=t.mergeWrites,this.defaultData=t.defaultData||{}}const o=r(3),i=r(56),a=r(8),s=r(1).ArgumentError;n.prototype.read=function(){const e=this;return new a(function(t,r){i.readFile(e.path,"utf8",function(n,o){if(n)return"ENOENT"===n.code?t(e.defaultData):r(n);try{return t(o&&o.length?JSON.parse(o):e.defaultData)}catch(i){return r(i)}})})},n.prototype.write=function(e){const t=this;var r=a.resolve(e);return t.mergeWrites&&(r=r.then(function(e){return t.read().then(function(t){return o.extend({},t,e)})})),r.then(function(e){return new a(function(r,n){try{return i.writeFile(t.path,JSON.stringify(e,null,2),"utf8",function(e){return e?n(e):r()})}catch(o){return n(o)}})})},e.exports=n},function(e,t,r){e.exports.FileStorageContext=r(36),e.exports.WebtaskStorageContext=r(38)},function(e,t,r){function n(e,t){if(null===e||void 0===e)throw new i("Must provide the Webtask storage object");t=t||{force:1},this.storage=e,this.options=t,this.defaultData=t.defaultData||{}}const o=r(8),i=r(1).ArgumentError;n.prototype.read=function(){const e=this;return new o(function(t,r){e.storage.get(function(n,o){return n?r(n):t(o||e.defaultData)})})},n.prototype.write=function(e){const t=this;return new o(function(r,n){t.storage.set(e,t.options,function(e){return e?n(e):r()})})},e.exports=n},function(e,t,r){function n(e){return e&&"[object Function]"==h.call(e)}function o(e){return function(t,r,n){d.get(e+"/userinfo").set("Authorization","Bearer "+t.body.access_token).end(function(e,o){return e?void r.redirect(r.locals.baseUrl):(t.userInfo=o.body,void n())})}}function i(e,t){return function(r,o,i){var a=e;n(e)&&(a=e(r)),r.apiToken=l.sign(r.userInfo,a,{algorithm:"HS256",issuer:o.locals.baseUrl,expiresIn:t}),delete r.userinfo,i()}}var a=r(16),s=r(58),c=r(55),u=r(11),p=r(19),f=r(14),l=r(2),d=r(10),h={}.toString;e.exports=function(e){var t=864e5,n=a.Router(),l=function(e,t,r){r()},d=[l];return e=e||{},e.clientName=e.clientName||"Auth0 Extension",e.clientId=e.clientId,e.exp=e.exp||t,e.credentialsRequired="undefined"!=typeof e.credentialsRequired&&e.credentialsRequired,e.scopes=e.scopes+" openid profile",e.responseType=e.responseType||"token",e.tokenExpiresIn=e.tokenExpiresIn||"10h",e.rootTenantAuthority=e.rootTenantAuthority||"https://auth0.auth0.com",e.authenticatedCallback=e.authenticatedCallback||function(e,t,r,n){n()},e.apiToken&&!e.apiToken.secret&&(console.log('You are using a "development secret" for API token generation. Please setup your secret on "apiToken.secret".'),e.apiToken.secret=r(15).randomBytes(32).toString("hex")),e.apiToken&&e.apiToken.secret&&(d=[o(e.rootTenantAuthority),e.apiToken.payload||l,i(e.apiToken.secret,e.tokenExpiresIn)]),n.use(function(e,t,r){var n="https",o=u.parse(e.originalUrl).pathname.replace(e.path,"");t.locals.baseUrl=u.format({protocol:n,host:e.get("host"),pathname:o}),r()}),n.use(f.urlencoded({extended:!1})),n.use(c({secret:p(),algorithms:["RS256"],credentialsRequired:e.credentialsRequired}).unless({path:["/login","/callback"]})),n.get("/login",function(t,r){var n=r.locals.baseUrl+"/callback";t.query.returnTo&&(n+="?returnTo="+encodeURIComponent(t.query.returnTo));var o;if("string"==typeof e.audience)o="&audience="+encodeURIComponent(e.audience);else if("function"==typeof e.audience){var i=e.audience(t);"string"==typeof i&&(o="&audience="+encodeURIComponent(i))}var a=[e.rootTenantAuthority+"/i/oauth2/authorize","?client_id="+(e.clientId||r.locals.baseUrl),"&response_type="+e.responseType,"&response_mode=form_post","&scope="+encodeURIComponent(e.scopes),"&expiration="+e.exp,"&redirect_uri="+n,o].join("");r.redirect(a)}),n.get("/logout",function(t,r){var n=["html","  head","    script.","      sessionStorage.removeItem('token')","      sessionStorage.removeItem('apiToken')","      window.location.href = '"+e.rootTenantAuthority+"/v2/logout?returnTo=#{baseUrl}';","  body"].join("\n"),o=s.compile(n)({baseUrl:r.locals.baseUrl});r.header("Content-Type","text/html"),r.status(200).send(o)}),n.post("/callback",d,function(t,r){e.authenticatedCallback(t,r,t.body.access_token,function(e){if(e)return r.sendStatus(500);var n=["html","  head","    script.","      sessionStorage.setItem('token', '"+t.body.access_token+"');",1===d.length?"":"      sessionStorage.setItem('apiToken', '"+t.apiToken+"');","      window.location.href = '#{returnTo}';","  body"].join("\n"),o=s.compile(n)({returnTo:t.query.returnTo?t.query.returnTo:r.locals.baseUrl});r.header("Content-Type","text/html"),r.status(200).send(o)})}),n.get("/.well-known/oauth2-client-configuration",function(t,r){r.header("Content-Type","application/json"),r.status(200).send({redirect_uris:[r.locals.baseUrl+"/callback"],client_name:e.clientName,post_logout_redirect_uris:[r.locals.baseUrl]})}),n}},function(e,t,r){"use strict";var n=r(54),o=r(9),i=r(20).urlHelpers;e.exports=function(){var e='\n    <!DOCTYPE html>\n    <html lang="en">\n    <head>\n      <title>User Import / Export Dashboard</title>\n      <meta charset="UTF-8" />\n      <meta http-equiv="X-UA-Compatible" content="IE=Edge" />\n      <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n      <link rel="shortcut icon" href="https://cdn.auth0.com/styleguide/2.0.1/lib/logos/img/favicon.png">\n      <meta name="viewport" content="width=device-width, initial-scale=1">\n      <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/styles/zocial.min.css">\n      <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/manage/v0.3.973/css/index.min.css">\n      <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/styleguide/3.8.4/index.css">\n      <% if (assets.version) { %>\n        <link rel="stylesheet" type="text/css" href="//cdn.auth0.com/extensions/auth0-user-import-export/assets/auth0-user-import-export.ui.<%= assets.version %>.css">\n      <% } %>\n    </head>\n    <body>\n      <div id="app"></div>\n      <script type="text/javascript">window.config = <%- JSON.stringify(config) %>;</script>\n      <script type="text/javascript" src="//cdn.auth0.com/js/lock-9.0.min.js"></script>\n      <script type="text/javascript" src="//cdn.auth0.com/manage/v0.3.973/components/ZeroClipboard/ZeroClipboard.js"></script>\n      <script type="text/javascript" src="//cdn.auth0.com/manage/v0.3.973/js/bundle.js"></script>\n      <% if (assets.app) { %><script type="text/javascript" src="<%= assets.app %>"></script><% } %>\n      <% if (assets.version) { %>\n      <script type="text/javascript" src="//cdn.auth0.com/extensions/auth0-user-import-export/assets/auth0-user-import-export.ui.vendors.<%= assets.version %>.js"></script>\n      <script type="text/javascript" src="//cdn.auth0.com/extensions/auth0-user-import-export/assets/auth0-user-import-export.ui.<%= assets.version %>.js"></script>\n      <% } %>\n    </body>\n    </html>\n  ';return function(t,r){var a={HOSTING_ENV:o.get("HOSTING_ENV"),CLIENT_VERSION:o.get("CLIENT_VERSION")||"???",AUTH0_DOMAIN:o.get("AUTH0_DOMAIN"),BASE_URL:i.getBaseUrl(t),BASE_PATH:i.getBasePath(t)};0!==a.BASE_PATH.indexOf("/")&&(a.BASE_PATH="/"+a.BASE_PATH);var s=o.get("CLIENT_VERSION");return s?r.send(n.render(e,{config:a,assets:{version:s}})):r.send(n.render(e,{config:a,assets:{app:"/app/bundle.js"}}))}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var o=r(42),i=n(o),a=(r(18),r(9)),s=r(16),c=r(14),u=r(39),p=r(7),f=r(47),l=r(40);e.exports=function(){var e=s();return e.use(c.json()),e.use(c.urlencoded({extended:!1})),e.use("/meta",function(e,t){t.status(200).send(f)}),e.post("/users-import",function(e,t){var r=!1,n={url:"https://"+a.get("AUTH0_DOMAIN")+"/api/v2/jobs/users-imports",headers:{Authorization:e.headers["x-authorization"]}},o=p.post(n,function(e,n,o){return r?null:(r=!0,e?(t.status(400),t.json({error:e&&e.message||o})):(t.status(n.statusCode),t.json(o)))});try{var s=o.form();s.append("users",(0,i["default"])(JSON.parse(e.body.users),null,2),{filename:"file.json",contentType:"text/plain"}),s.append("connection_id",e.body.connection_id)}catch(c){if(r)return;r=!0,t.status(400),t.json({error:c.message})}}),e.use(u({scopes:"create:users read:users read:connections",clientName:"User Import / Export Extension"})),e.get("*",l()),{NODE_ENV:"production",CLIENT_VERSION:"1.4.2"}.PORT||3e3,e}},function(e,t,r){e.exports={"default":r(43),__esModule:!0}},function(e,t,r){var n=r(44),o=n.JSON||(n.JSON={stringify:JSON.stringify});e.exports=function(e){return o.stringify.apply(o,arguments)}},function(e,t){var r=e.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(e,t){var r={};t.escapeJavaScript=function(e){if(!e)return"";for(var t="",n=0,o=e.length;n<o;++n){var i=e.charCodeAt(n);t+=r.isSafe(i)?e[n]:r.escapeJavaScriptChar(i)}return t},t.escapeHtml=function(e){if(!e)return"";for(var t="",n=0,o=e.length;n<o;++n){var i=e.charCodeAt(n);t+=r.isSafe(i)?e[n]:r.escapeHtmlChar(i)}return t},r.escapeJavaScriptChar=function(e){if(e>=256)return"\\u"+r.padLeft(""+e,4);var t=new Buffer(String.fromCharCode(e),"ascii").toString("hex");return"\\x"+r.padLeft(t,2)},r.escapeHtmlChar=function(e){var t=r.namedHtml[e];if("undefined"!=typeof t)return t;if(e>=256)return"&#"+e+";";var n=new Buffer(String.fromCharCode(e),"ascii").toString("hex");return"&#x"+r.padLeft(n,2)+";"},r.padLeft=function(e,t){for(;e.length<t;)e="0"+e;return e},r.isSafe=function(e){return"undefined"!=typeof r.safeCharCodes[e]},r.namedHtml={38:"&amp;",60:"&lt;",62:"&gt;",34:"&quot;",160:"&nbsp;",162:"&cent;",163:"&pound;",164:"&curren;",169:"&copy;",174:"&reg;"},r.safeCharCodes=function(){for(var e={},t=32;t<123;++t)(t>=97||t>=65&&t<=90||t>=48&&t<=57||32===t||46===t||44===t||45===t||58===t||95===t)&&(e[t]=null);return e}()},function(e,t,r){var n=r(15),o=r(18),i=r(61),a=r(45),s={};t.clone=function(e,r){if("object"!=typeof e||null===e)return e;r=r||{orig:[],copy:[]};var n=r.orig.indexOf(e);if(n!==-1)return r.copy[n];var o,i=!1;if(Array.isArray(e))o=[],i=!0;else if(Buffer.isBuffer(e))o=new Buffer(e);else if(e instanceof Date)o=new Date(e.getTime());else if(e instanceof RegExp)o=new RegExp(e);else{var a=Object.getPrototypeOf(e);a&&a.isImmutable?o=e:(o=Object.create(a),i=!0)}if(r.orig.push(e),r.copy.push(o),i)for(var s=Object.getOwnPropertyNames(e),c=0,u=s.length;c<u;++c){var p=s[c],f=Object.getOwnPropertyDescriptor(e,p);f&&(f.get||f.set)?Object.defineProperty(o,p,f):o[p]=t.clone(e[p],r)}return o},t.merge=function(e,r,n,o){if(t.assert(e&&"object"==typeof e,"Invalid target value: must be an object"),t.assert(null===r||void 0===r||"object"==typeof r,"Invalid source value: must be null, undefined, or an object"),!r)return e;if(Array.isArray(r)){t.assert(Array.isArray(e),"Cannot merge array onto an object"),o===!1&&(e.length=0);for(var i=0,a=r.length;i<a;++i)e.push(t.clone(r[i]));return e}for(var s=Object.keys(r),c=0,u=s.length;c<u;++c){var p=s[c],f=r[p];f&&"object"==typeof f?!e[p]||"object"!=typeof e[p]||Array.isArray(e[p])^Array.isArray(f)||f instanceof Date||Buffer.isBuffer(f)||f instanceof RegExp?e[p]=t.clone(f):t.merge(e[p],f,n,o):null!==f&&void 0!==f?e[p]=f:n!==!1&&(e[p]=f)}return e},t.applyToDefaults=function(e,r,n){if(t.assert(e&&"object"==typeof e,"Invalid defaults value: must be an object"),t.assert(!r||r===!0||"object"==typeof r,"Invalid options value: must be true, falsy or an object"),!r)return null;var o=t.clone(e);return r===!0?o:t.merge(o,r,n===!0,!1)},t.cloneWithShallow=function(e,r){if(!e||"object"!=typeof e)return e;var n=s.store(e,r),o=t.clone(e);return s.restore(o,e,n),o},s.store=function(e,r){for(var n={},o=0,i=r.length;o<i;++o){var a=r[o],c=t.reach(e,a);void 0!==c&&(n[a]=c,s.reachSet(e,a,void 0))}return n},s.restore=function(e,t,r){for(var n=Object.keys(r),o=0,i=n.length;o<i;++o){var a=n[o];s.reachSet(e,a,r[a]),s.reachSet(t,a,r[a])}},s.reachSet=function(e,t,r){for(var n=t.split("."),o=e,i=0,a=n.length;i<a;++i){var s=n[i];i+1===a&&(o[s]=r),o=o[s]}},t.applyToDefaultsWithShallow=function(e,r,n){if(t.assert(e&&"object"==typeof e,"Invalid defaults value: must be an object"),t.assert(!r||r===!0||"object"==typeof r,"Invalid options value: must be true, falsy or an object"),t.assert(n&&Array.isArray(n),"Invalid keys"),!r)return null;var o=t.cloneWithShallow(e,n);if(r===!0)return o;var i=s.store(r,n);return t.merge(o,r,!1,!1),s.restore(o,r,i),o},t.deepEqual=function(e,r,n,o){n=n||{prototype:!0};var i=typeof e;if(i!==typeof r)return!1;if("object"!==i||null===e||null===r)return e===r?0!==e||1/e===1/r:e!==e&&r!==r;if(o=o||[],o.indexOf(e)!==-1)return!0;if(o.push(e),Array.isArray(e)){if(!Array.isArray(r))return!1;if(!n.part&&e.length!==r.length)return!1;for(var a=0,s=e.length;a<s;++a){if(n.part){for(var c=!1,u=0,p=r.length;u<p;++u)if(t.deepEqual(e[a],r[u],n,o)){c=!0;break}return c}if(!t.deepEqual(e[a],r[a],n,o))return!1}return!0}if(Buffer.isBuffer(e)){if(!Buffer.isBuffer(r))return!1;if(e.length!==r.length)return!1;for(var f=0,l=e.length;f<l;++f)if(e[f]!==r[f])return!1;return!0}if(e instanceof Date)return r instanceof Date&&e.getTime()===r.getTime();if(e instanceof RegExp)return r instanceof RegExp&&e.toString()===r.toString();if(n.prototype&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(r))return!1;var d=Object.getOwnPropertyNames(e);if(!n.part&&d.length!==Object.getOwnPropertyNames(r).length)return!1;for(var h=0,g=d.length;h<g;++h){var m=d[h],y=Object.getOwnPropertyDescriptor(e,m);if(y.get){if(!t.deepEqual(y,Object.getOwnPropertyDescriptor(r,m),n,o))return!1}else if(!t.deepEqual(e[m],r[m],n,o))return!1}return!0},t.unique=function(e,t){for(var r={},n=[],o=0,i=e.length;o<i;++o){var a=t?e[o][t]:e[o];r[a]!==!0&&(n.push(e[o]),r[a]=!0)}return n},t.mapToObject=function(e,t){if(!e)return null;for(var r={},n=0,o=e.length;n<o;++n)t?e[n][t]&&(r[e[n][t]]=!0):r[e[n]]=!0;return r},t.intersect=function(e,r,n){if(!e||!r)return[];for(var o=[],i=Array.isArray(e)?t.mapToObject(e):e,a={},s=0,c=r.length;s<c;++s)if(i[r[s]]&&!a[r[s]]){if(n)return r[s];o.push(r[s]),a[r[s]]=!0}return n?null:o},t.contain=function(e,r,n){var o=null;"object"!=typeof e||"object"!=typeof r||Array.isArray(e)||Array.isArray(r)?r=[].concat(r):(o=r,r=Object.keys(r)),n=n||{},t.assert(arguments.length>=2,"Insufficient arguments"),t.assert("string"==typeof e||"object"==typeof e,"Reference must be string or an object"),t.assert(r.length,"Values array cannot be empty");var i,a;if(n.deep){i=t.deepEqual;var s=n.hasOwnProperty("only"),c=n.hasOwnProperty("part");a={prototype:s?n.only:!!c&&!n.part,part:s?!n.only:!c||n.part}}else i=function(e,t){return e===t};for(var u=!1,p=new Array(r.length),f=0,l=p.length;f<l;++f)p[f]=0;if("string"==typeof e){var d="(";for(f=0,l=r.length;f<l;++f){var h=r[f];t.assert("string"==typeof h,"Cannot compare string reference to non-string value"),d+=(f?"|":"")+t.escapeRegex(h)}var g=new RegExp(d+")","g"),m=e.replace(g,function(e,t){var n=r.indexOf(t);return++p[n],""});u=!!m}else if(Array.isArray(e))for(f=0,l=e.length;f<l;++f){for(var y=0,v=r.length,b=!1;y<v&&b===!1;++y)b=i(r[y],e[f],a)&&y;b!==!1?++p[b]:u=!0}else{var x=Object.keys(e);for(f=0,l=x.length;f<l;++f){var w=x[f],E=r.indexOf(w);if(E!==-1){if(o&&!i(o[w],e[w],a))return!1;++p[E]}else u=!0}}var T=!1;for(f=0,l=p.length;f<l;++f)if(T=T||!!p[f],n.once&&p[f]>1||!n.part&&!p[f])return!1;return(!n.only||!u)&&T},t.flatten=function(e,r){for(var n=r||[],o=0,i=e.length;o<i;++o)Array.isArray(e[o])?t.flatten(e[o],n):n.push(e[o]);return n},t.reach=function(e,r,n){if(r===!1||null===r||"undefined"==typeof r)return e;n=n||{},"string"==typeof n&&(n={separator:n});for(var o=r.split(n.separator||"."),i=e,a=0,s=o.length;a<s;++a){var c=o[a];if("-"===c[0]&&Array.isArray(i)&&(c=c.slice(1,c.length),
c=i.length-c),!i||!i.hasOwnProperty(c)||"object"!=typeof i&&n.functions===!1){t.assert(!n.strict||a+1===s,"Missing segment",c,"in reach path ",r),t.assert("object"==typeof i||n.functions===!0||"function"!=typeof i,"Invalid segment",c,"in reach path ",r),i=n["default"];break}i=i[c]}return i},t.reachTemplate=function(e,r,n){return r.replace(/{([^}]+)}/g,function(r,o){var i=t.reach(e,o,n);return void 0===i||null===i?"":i})},t.formatStack=function(e){for(var t=[],r=0,n=e.length;r<n;++r){var o=e[r];t.push([o.getFileName(),o.getLineNumber(),o.getColumnNumber(),o.getFunctionName(),o.isConstructor()])}return t},t.formatTrace=function(e){for(var t=[],r=0,n=e.length;r<n;++r){var o=e[r];t.push((o[4]?"new ":"")+o[3]+" ("+o[0]+":"+o[1]+":"+o[2]+")")}return t},t.callStack=function(e){var r=Error.prepareStackTrace;Error.prepareStackTrace=function(e,t){return t};var n={};Error.captureStackTrace(n,arguments.callee);var o=n.stack;Error.prepareStackTrace=r;var i=t.formatStack(o);return e?i.slice(e):i},t.displayStack=function(e){var r=t.callStack(void 0===e?1:e+1);return t.formatTrace(r)},t.abortThrow=!1,t.abort=function(e,r){if(t.abortThrow===!0)throw new Error(e||"Unknown error");var n="";r||(n=t.displayStack(1).join("\n\t")),console.log("ABORT: "+e+"\n\t"+n),process.exit(1)},t.assert=function(e){if(!e){if(2===arguments.length&&arguments[1]instanceof Error)throw arguments[1];for(var r=[],n=1,o=arguments.length;n<o;++n)""!==arguments[n]&&r.push(arguments[n]);throw r=r.map(function(e){return"string"==typeof e?e:e instanceof Error?e.message:t.stringify(e)}),new Error(r.join(" ")||"Unknown error")}},t.Timer=function(){this.ts=0,this.reset()},t.Timer.prototype.reset=function(){this.ts=Date.now()},t.Timer.prototype.elapsed=function(){return Date.now()-this.ts},t.Bench=function(){this.ts=0,this.reset()},t.Bench.prototype.reset=function(){this.ts=t.Bench.now()},t.Bench.prototype.elapsed=function(){return t.Bench.now()-this.ts},t.Bench.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},t.escapeRegex=function(e){return e.replace(/[\^\$\.\*\+\-\?\=\!\:\|\\\/\(\)\[\]\{\}\,]/g,"\\$&")},t.base64urlEncode=function(e,t){var r=Buffer.isBuffer(e)?e:new Buffer(e,t||"binary");return r.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")},t.base64urlDecode=function(e,t){if(e&&!/^[\w\-]*$/.test(e))return new Error("Invalid character");try{var r=new Buffer(e,"base64");return"buffer"===t?r:r.toString(t||"binary")}catch(n){return n}},t.escapeHeaderAttribute=function(e){return t.assert(/^[ \w\!#\$%&'\(\)\*\+,\-\.\/\:;<\=>\?@\[\]\^`\{\|\}~\"\\]*$/.test(e),"Bad attribute value ("+e+")"),e.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')},t.escapeHtml=function(e){return a.escapeHtml(e)},t.escapeJavaScript=function(e){return a.escapeJavaScript(e)},t.nextTick=function(e){return function(){var t=arguments;process.nextTick(function(){e.apply(null,t)})}},t.once=function(e){if(e._hoekOnce)return e;var t=!1,r=function(){t||(t=!0,e.apply(null,arguments))};return r._hoekOnce=!0,r},t.isAbsolutePath=function(e,t){return!!e&&(o.isAbsolute?o.isAbsolute(e):(t=t||process.platform,"win32"!==t?"/"===e[0]:!!/^(?:[a-zA-Z]:[\\\/])|(?:[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/])/.test(e)))},t.isInteger=function(e){return"number"==typeof e&&parseFloat(e)===parseInt(e,10)&&!isNaN(e)},t.ignore=function(){},t.inherits=i.inherits,t.format=i.format,t.transform=function(e,r,n){if(t.assert(null===e||void 0===e||"object"==typeof e||Array.isArray(e),"Invalid source object: must be null, undefined, an object, or an array"),Array.isArray(e)){for(var o=[],i=0,a=e.length;i<a;++i)o.push(t.transform(e[i],r,n));return o}for(var s={},c=Object.keys(r),u=0,p=c.length;u<p;++u){var f=c[u],l=f.split("."),d=r[f];t.assert("string"==typeof d,'All mappings must be "." delineated strings');for(var h,g=s;l.length>1;)h=l.shift(),g[h]||(g[h]={}),g=g[h];h=l.shift(),g[h]=t.reach(e,d,n)}return s},t.uniqueFilename=function(e,t){t=t?"."!==t[0]?"."+t:t:"",e=o.resolve(e);var r=[Date.now(),process.pid,n.randomBytes(8).toString("hex")].join("-")+t;return o.join(e,r)},t.stringify=function(){try{return JSON.stringify.apply(null,arguments)}catch(e){return"[Cannot display object: "+e.message+"]"}},t.shallow=function(e){for(var t={},r=Object.keys(e),n=0,o=r.length;n<o;++n){var i=r[n];t[i]=e[i]}return t}},function(e,t){e.exports={title:"User Import / Export test",name:"auth0-user-import-export-test",version:"1.4.2",author:"auth0",description:"This extension allows you to import/export users from/to your account.",type:"application",logoUrl:"https://cdn.rawgit.com/auth0/auth0-user-import-export-extension/master/assets/logo.svg",initialUrlPath:"/login",repository:"https://github.com/zxan1285/auth0-user-import-export-extension-test",keywords:["auth0","extension"],auth0:{scopes:"create:users read:users read:connections"}}},function(e,t,r){const n=r(17),o=r(3),i=["max","maxAge","length","dispose","stale"];e.exports=function(e){const t=new n(o.pick(e,i)),r=e.load,a=e.hash,s=e.bypass,c=e.itemMaxAge,u=new Map;if(e.disable)return r;const p=function(){const e=o.toArray(arguments),n=e.slice(0,-1),i=e.slice(-1).pop(),p=this;var f;if(s&&s.apply(p,n))return r.apply(p,e);f=0!==n.length||a?a.apply(p,n):"_";var l=t.get(f);return l?i.apply(null,[null].concat(l)):void(u.get(f)?u.get(f).push(i):(u.set(f,[]),r.apply(p,n.concat(function(e){const r=o.toArray(arguments);if(!e){const a=r.slice(1);c?t.set(f,a,c.apply(p,n.concat(a))):t.set(f,a)}u.get(f).forEach(function(e){e.apply(null,r)}),u["delete"](f),i.apply(null,r)}))))};return p.keys=t.keys.bind(t),p},e.exports.sync=function(e){const t=new n(o.pick(e,i)),r=e.load,a=e.hash,s=e.disable,c=e.bypass,u=this,p=e.itemMaxAge;if(s)return r;const f=function(){var e=o.toArray(arguments);if(c&&c.apply(u,arguments))return r.apply(u,arguments);var n=a.apply(u,e),i=t.get(n);if(i)return i;const s=r.apply(u,e);return p?t.set(n,s,p.apply(u,e.concat([s]))):t.set(n,s),s};return f.keys=t.keys.bind(t),f}},function(e,t,r){var n=r(6);e.exports=function(e,t,o,i,a,s){function c(){var e=t.getApiKey(o,i);if(!e)return t.loginError({code:401,message:"Unauthorized.",error:"Missing apiKey.",redirect:s.baseUrl+"/login"},o,i,a,s.baseUrl);var c=t.webtaskSecret(o,i);if(!c)return n({code:400,message:"The webtask secret must be provided to allow for validating apiKeys."},a);try{o.user=i.user=r(2).verify(e,c)}catch(p){return t.loginError({code:401,message:"Unauthorized.",error:p.message},o,i,a,s.baseUrl)}return o.apiKey=e,t.authorized&&!t.authorized(o,i)?t.loginError({code:403,message:"Forbidden."},o,i,a,s.baseUrl):u()}function u(){return e(o,i,a)}return t.exclude&&t.exclude(o,i,s.appPath)?u():c()}},function(e,t,r){function n(e,t){return function(r,n,i){if(!n.x_wt.jtn||!n.x_wt.container)return s({code:400,message:"Auth0 authentication can only be used with named webtasks."},i);var a=o(n);if(!a)return s({code:400,message:"Error processing request URL path."},i);switch("GET"===n.method&&a.appPath){case"/login":u(t,r,n,i,a);break;case"/callback":p(t,r,n,i,a);break;default:c(e,t,r,n,i,a)}}}function o(e){var t=a.parse(e.url,!0),r=t.pathname.split("/");if("api"===r[1]&&"run"===r[2]&&r[3]===e.x_wt.container&&r[4]===e.x_wt.jtn)t.basePath=r.splice(0,5).join("/");else{if(r[1]!==e.x_wt.container||r[2]!==e.x_wt.jtn)return null;t.basePath=r.splice(0,3).join("/")}return t.appPath="/"+r.join("/"),t.baseUrl=[e.headers["x-forwarded-proto"]||"https","://",e.headers.host,t.basePath].join(""),t}function i(e){return f.replace("##",e)}var a=r(11),s=r(6),c=r(49),u=r(52),p=r(51);e.exports=function(e,t){if("function"!=typeof e||3!==e.length)throw new Error("The auth0() function can only be called on webtask functions with the (ctx, req, res) signature.");if(t||(t={}),"object"!=typeof t)throw new Error("The options parameter must be an object.");if(t.scope&&"string"!=typeof t.scope)throw new Error("The scope option, if specified, must be a string.");if(t.authorized&&["string","function"].indexOf(typeof t.authorized)<0&&!Array.isArray(t.authorized))throw new Error("The authorized option, if specified, must be a string or array of strings with e-mail or domain names, or a function that accepts (ctx, req) and returns boolean.");if(t.exclude&&["string","function"].indexOf(typeof t.exclude)<0&&!Array.isArray(t.exclude))throw new Error("The exclude option, if specified, must be a string or array of strings with URL paths that do not require authentication, or a function that accepts (ctx, req, appPath) and returns boolean.");if(t.clientId&&"function"!=typeof t.clientId)throw new Error("The clientId option, if specified, must be a function that accepts (ctx, req) and returns an Auth0 Client ID.");if(t.clientSecret&&"function"!=typeof t.clientSecret)throw new Error("The clientSecret option, if specified, must be a function that accepts (ctx, req) and returns an Auth0 Client Secret.");if(t.domain&&"function"!=typeof t.domain)throw new Error("The domain option, if specified, must be a function that accepts (ctx, req) and returns an Auth0 Domain.");if(t.webtaskSecret&&"function"!=typeof t.webtaskSecret)throw new Error("The webtaskSecret option, if specified, must be a function that accepts (ctx, req) and returns a key to be used to sign issued JWT tokens.");if(t.getApiKey&&"function"!=typeof t.getApiKey)throw new Error("The getApiKey option, if specified, must be a function that accepts (ctx, req) and returns an apiKey associated with the request.");if(t.loginSuccess&&"function"!=typeof t.loginSuccess)throw new Error("The loginSuccess option, if specified, must be a function that accepts (ctx, req, res, baseUrl) and generates a response.");if(t.loginError&&"function"!=typeof t.loginError)throw new Error("The loginError option, if specified, must be a function that accepts (error, ctx, req, res, baseUrl) and generates a response.");if(t.clientId=t.clientId||function(e,t){return e.secrets.AUTH0_CLIENT_ID},t.clientSecret=t.clientSecret||function(e,t){return e.secrets.AUTH0_CLIENT_SECRET},t.domain=t.domain||function(e,t){return e.secrets.AUTH0_DOMAIN},t.webtaskSecret=t.webtaskSecret||function(e,t){return e.secrets.WEBTASK_SECRET||t.x_wt.token},t.getApiKey=t.getApiKey||function(e,t){return t.headers.authorization&&"Bearer"===t.headers.authorization.split(" ")[0]?t.headers.authorization.split(" ")[1]:t.query&&t.query.apiKey?t.query.apiKey:null},t.loginSuccess=t.loginSuccess||function(e,t,r,n){return r.writeHead(302,{Location:n+"?apiKey="+e.apiKey}),r.end()},t.loginError=t.loginError||function(e,t,r,n,o){return"GET"===r.method?e.redirect?(n.writeHead(302,{Location:e.redirect}),n.end(JSON.stringify(e))):(n.writeHead(e.code||401,{"Content-Type":"text/html","Cache-Control":"no-cache"}),n.end(i(o+"/login"))):e(e,n)},"string"==typeof t.authorized&&(t.authorized=[t.authorized]),Array.isArray(t.authorized)){var r=[];t.authorized.forEach(function(e){r.push(e.toLowerCase())}),t.authorized=function(e,t){if(e.user.email_verified)for(var n=0;n<r.length;n++){var o=e.user.email.toLowerCase();if(o===r[n]||"@"===r[n][0]&&o.indexOf(r[n])>1)return!0}return!1}}if("string"==typeof t.exclude&&(t.exclude=[t.exclude]),Array.isArray(t.exclude)){var o=t.exclude;t.exclude=function(e,t,r){return o.indexOf(r)>-1}}return n(e,t)};var f='<!DOCTYPE html5><html><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link href="https://cdn.auth0.com/styleguide/latest/index.css" rel="stylesheet" /><title>Access denied</title></head><body><div class="container"><div class="row text-center"><h1><a href="https://auth0.com" title="Go to Auth0!"><img src="https://cdn.auth0.com/styleguide/1.0.0/img/badge.svg" alt="Auth0 badge" /></a></h1> <h1>Not authorized</h1><p><a href="##">Try again</a></p></div></div></body></html>'},function(e,t,r){var n=r(6);e.exports=function(e,t,o,i,a){function s(s){var c,u=r(2);try{c=u.decode(s)}catch(p){return e.loginError({code:502,message:"Cannot parse id_token returned from Auth0.",id_token:s,error:p.message},t,o,i,a.baseUrl)}var f=e.webtaskSecret(t,o);return f?(c.iss=a.baseUrl,o.user=t.user=c,t.apiKey=u.sign(c,f),e.loginSuccess(t,o,i,a.baseUrl)):n({code:400,message:"The webtask secret must be be provided to allow for issuing apiKeys."},i)}if(!t.query.code)return e.loginError({code:401,message:"Authentication error.",callbackQuery:t.query},t,o,i,a.baseUrl);var c={clientId:e.clientId(t,o),domain:e.domain(t,o),clientSecret:e.clientSecret(t,o)},u=!!c.clientId+!!c.domain+!!c.clientSecret;return 3!==u?n({code:400,message:"Auth0 Client ID, Client Secret, and Auth0 Domain must be specified."},i):r(10).post("https://"+c.domain+"/oauth/token").type("form").send({client_id:c.clientId,client_secret:c.clientSecret,redirect_uri:a.baseUrl+"/callback",code:t.query.code,grant_type:"authorization_code"}).timeout(15e3).end(function(r,n){return r||!n.ok?e.loginError({code:502,message:"OAuth code exchange completed with error.",error:r&&r.message,auth0Status:n&&n.status,auth0Response:n&&(n.body||n.text)},t,o,i,a.baseUrl):s(n.body.id_token)})}},function(e,t,r){var n=r(6);e.exports=function(e,t,r,o,i){var a={clientId:e.clientId(t,r),domain:e.domain(t,r)},s=!!a.clientId+!!a.domain,c="openid name email email_verified "+(e.scope||"");if(0===s)return n({code:501,message:"Not implemented."},o);if(2===s){var u="https://"+a.domain+"/authorize?response_type=code&scope="+encodeURIComponent(c)+"&client_id="+encodeURIComponent(a.clientId)+"&redirect_uri="+encodeURIComponent(i.baseUrl+"/callback");return o.writeHead(302,{Location:u}),o.end()}return n({code:400,message:"Both or neither Auth0 Client ID and Auth0 domain must be specified."},o)}},function(e,t){e.exports=require("auth0@2.1.0")},function(e,t){e.exports=require("ejs")},function(e,t){e.exports=require("express-jwt")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("jade")},function(e,t){e.exports=require("ms")},function(e,t){e.exports=require("node-uuid")},function(e,t){e.exports=require("util")}]);