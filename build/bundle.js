module.exports=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";var r=n(1),o=n(23),s=null;e.exports=o.fromExpress(function(e,t){if(!s){console.log("Creating server."),console.log(" > Environment:",{NODE_ENV:"production",CLIENT_VERSION:"1.4.4"}),console.log(" > Secrets:",{AUTH0_DOMAIN:e.webtaskContext.secrets.AUTH0_DOMAIN,AUTH0_SCOPES:e.webtaskContext.secrets.AUTH0_SCOPES,NODE_ENV:"production",HOSTING_ENV:"webtask",CLIENT_VERSION:"1.4.4"}),r.env().argv().overrides({AUTH0_DOMAIN:e.webtaskContext.secrets.AUTH0_DOMAIN,AUTH0_SCOPES:e.webtaskContext.secrets.AUTH0_SCOPES,NODE_ENV:"production",HOSTING_ENV:"webtask",CLIENT_VERSION:"1.4.4"});var o=n(9);s=o()}return s(e,t)})},function(e,t){e.exports=require("nconf")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("request")},function(e,t){e.exports=require("url")},function(e,t,n){function r(e){return e&&"[object Function]"==f.call(e)}function o(e){return function(t,n,r){h.get(e+"/userinfo").set("Authorization","Bearer "+t.body.access_token).end(function(e,o){return e?void n.redirect(n.locals.baseUrl):(t.userInfo=o.body,void r())})}}function s(e,t){return function(n,o,s){var i=e;r(e)&&(i=e(n)),n.apiToken=d.sign(n.userInfo,i,{algorithm:"HS256",issuer:o.locals.baseUrl,expiresIn:t}),delete n.userinfo,s()}}var i=n(3),a=n(17),c=n(16),u=n(5),p=n(7),l=n(2),d=n(18),h=n(22),f={}.toString;e.exports=function(e){var t=864e5,r=i.Router(),d=function(e,t,n){n()},h=[d];return e=e||{},e.clientName=e.clientName||"Auth0 Extension",e.clientId=e.clientId,e.exp=e.exp||t,e.credentialsRequired="undefined"==typeof e.credentialsRequired?!1:e.credentialsRequired,e.scopes=e.scopes+" openid profile",e.responseType=e.responseType||"token",e.tokenExpiresIn=e.tokenExpiresIn||"10h",e.rootTenantAuthority=e.rootTenantAuthority||"https://auth0.auth0.com",e.authenticatedCallback=e.authenticatedCallback||function(e,t,n,r){r()},e.apiToken&&!e.apiToken.secret&&(console.log('You are using a "development secret" for API token generation. Please setup your secret on "apiToken.secret".'),e.apiToken.secret=n(14).randomBytes(32).toString("hex")),e.apiToken&&e.apiToken.secret&&(h=[o(e.rootTenantAuthority),e.apiToken.payload||d,s(e.apiToken.secret,e.tokenExpiresIn)]),r.use(function(e,t,n){var r="https",o=u.parse(e.originalUrl).pathname.replace(e.path,"");t.locals.baseUrl=u.format({protocol:r,host:e.get("host"),pathname:o}),n()}),r.use(l.urlencoded({extended:!1})),r.use(c({secret:p(),algorithms:["RS256"],credentialsRequired:e.credentialsRequired}).unless({path:["/login","/callback"]})),r.get("/login",function(t,n){var r=n.locals.baseUrl+"/callback";t.query.returnTo&&(r+="?returnTo="+encodeURIComponent(t.query.returnTo));var o;if("string"==typeof e.audience)o="&audience="+encodeURIComponent(e.audience);else if("function"==typeof e.audience){var s=e.audience(t);"string"==typeof s&&(o="&audience="+encodeURIComponent(s))}var i=[e.rootTenantAuthority+"/i/oauth2/authorize","?client_id="+(e.clientId||n.locals.baseUrl),"&response_type="+e.responseType,"&response_mode=form_post","&scope="+encodeURIComponent(e.scopes),"&expiration="+e.exp,"&redirect_uri="+r,o].join("");n.redirect(i)}),r.get("/logout",function(t,n){var r=["html","  head","    script.","      sessionStorage.removeItem('token')","      sessionStorage.removeItem('apiToken')","      window.location.href = '"+e.rootTenantAuthority+"/v2/logout?returnTo=#{baseUrl}';","  body"].join("\n"),o=a.compile(r)({baseUrl:n.locals.baseUrl});n.header("Content-Type","text/html"),n.status(200).send(o)}),r.post("/callback",h,function(t,n){e.authenticatedCallback(t,n,t.body.access_token,function(e){if(e)return n.sendStatus(500);var r=["html","  head","    script.","      sessionStorage.setItem('token', '"+t.body.access_token+"');",1===h.length?"":"      sessionStorage.setItem('apiToken', '"+t.apiToken+"');","      window.location.href = '#{returnTo}';","  body"].join("\n"),o=a.compile(r)({returnTo:t.query.returnTo?t.query.returnTo:n.locals.baseUrl});n.header("Content-Type","text/html"),n.status(200).send(o)})}),r.get("/.well-known/oauth2-client-configuration",function(t,n){n.header("Content-Type","application/json"),n.status(200).send({redirect_uris:[n.locals.baseUrl+"/callback"],client_name:e.clientName,post_logout_redirect_uris:[n.locals.baseUrl]})}),r}},function(e,t,n){function r(e){return e=e.match(/.{1,64}/g).join("\n"),e="-----BEGIN CERTIFICATE-----\n"+e,e+="\n-----END CERTIFICATE-----\n"}var o=n(20),s=n(4),i=n(19),a={max:5242880,length:function(e){return e.length},maxAge:3e5},c=o(a);e.exports=function(e){return e=e||{},e.strictSSL="undefined"==typeof e.strictSSL?!0:e.strictSSL,function(t,n,o,a){var u=o.iss+"|"+o.aud,p=c.get(u);if(p)return a(null,p);switch(n.alg){case"RS256":var l=o.iss+".well-known/jwks.json";s.get(l,{json:!0,strictSSL:e.strictSSL},function(e,t,s){if(e)return a(e);if(200!==t.statusCode)return a(new Error("Failed to obtain JWKS from "+o.iss));var p=i.find(s.keys,function(e){return e.kid==n.kid});if(!p)return a(new Error("Failed to obtain signing key used by "+o.iss));var l=r(p.x5c[0]);return c.set(u,l),a(null,l)});break;default:return a(new Error("Unsupported JWT algorithm: "+n.alg))}}}},function(e,t,n){"use strict";var r=n(15),o=n(5),s=n(1);e.exports=function(){var e='\n    <!DOCTYPE html>\n    <html lang="en">\n    <head>\n      <title>User Import / Export Dashboard</title>\n      <meta charset="UTF-8" />\n      <meta http-equiv="X-UA-Compatible" content="IE=Edge" />\n      <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n      <link rel="shortcut icon" href="https://cdn.auth0.com/styleguide/2.0.1/lib/logos/img/favicon.png">\n      <meta name="viewport" content="width=device-width, initial-scale=1">\n      <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/styles/zocial.min.css">\n      <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/manage/v0.3.973/css/index.min.css">\n      <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/styleguide/3.8.4/index.css">\n      <% if (assets.version) { %>\n        <link rel="stylesheet" type="text/css" href="//cdn.auth0.com/extensions/auth0-user-import-export/assets/auth0-user-import-export.ui.<%= assets.version %>.css">\n      <% } %>\n    </head>\n    <body>\n      <div id="app"></div>\n      <script type="text/javascript">window.config = <%- JSON.stringify(config) %>;</script>\n      <script type="text/javascript" src="//cdn.auth0.com/js/lock-9.0.min.js"></script>\n      <script type="text/javascript" src="//cdn.auth0.com/manage/v0.3.973/components/ZeroClipboard/ZeroClipboard.js"></script>\n      <script type="text/javascript" src="//cdn.auth0.com/manage/v0.3.973/js/bundle.js"></script>\n      <% if (assets.app) { %><script type="text/javascript" src="<%= assets.app %>"></script><% } %>\n      <% if (assets.version) { %>\n      <script type="text/javascript" src="//cdn.auth0.com/extensions/auth0-user-import-export/assets/auth0-user-import-export.ui.vendors.<%= assets.version %>.js"></script>\n      <script type="text/javascript" src="//cdn.auth0.com/extensions/auth0-user-import-export/assets/auth0-user-import-export.ui.<%= assets.version %>.js"></script>\n      <% } %>\n    </body>\n    </html>\n  ';return function(t,n,i){var a={HOSTING_ENV:s.get("HOSTING_ENV"),CLIENT_VERSION:s.get("CLIENT_VERSION")||"???",AUTH0_DOMAIN:s.get("AUTH0_DOMAIN"),BASE_URL:o.format({protocol:"production"===s.get("NODE_ENV")||"webtask"===s.get("HOSTING_ENV")?"https":"http",host:t.get("host"),pathname:o.parse(t.originalUrl||"").pathname.replace(t.path,"")}),BASE_PATH:o.parse(t.originalUrl||"").pathname.replace(t.path,"")};0!==a.BASE_PATH.indexOf("/")&&(a.BASE_PATH="/"+a.BASE_PATH);var c=s.get("CLIENT_VERSION");return c?n.send(r.render(e,{config:a,assets:{version:c}})):void n.send(r.render(e,{config:a,assets:{app:"/app/bundle.js"}}))}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var o=n(10),s=r(o),i=(n(21),n(1)),a=n(3),c=n(2),u=n(6),p=n(4),l=n(13),d=n(8);e.exports=function(){var e=a();return e.use(c.json()),e.use(c.urlencoded({extended:!1})),e.use("/meta",function(e,t){t.status(200).send(l)}),e.post("/users-import",function(e,t){var n=!1,r={url:"https://"+i.get("AUTH0_DOMAIN")+"/api/v2/jobs/users-imports",headers:{Authorization:e.headers["x-authorization"]}},o=p.post(r,function(e,r,o){return n?null:(n=!0,e?(t.status(400),t.json({error:e&&e.message||o})):(t.status(r.statusCode),t.json(o)))});try{var a=o.form();a.append("users",(0,s["default"])(JSON.parse(e.body.users),null,2),{filename:"file.json",contentType:"text/plain"}),a.append("connection_id",e.body.connection_id)}catch(c){if(n)return;n=!0,t.status(400),t.json({error:c.message})}}),e.use(function(e,t,n){u({scopes:"create:users read:users read:connections",clientName:"User Import / Export Extension",audience:function(e){return"https://"+e.webtaskContext.data.AUTH0_DOMAIN+"/api/v2/"},rootTenantAuthority:e.webtaskContext.data.AUTH0_RTA})(e,t,n)}),e.get("*",d()),{NODE_ENV:"production",CLIENT_VERSION:"1.4.4"}.PORT||3e3,e}},function(e,t,n){e.exports={"default":n(11),__esModule:!0}},function(e,t,n){var r=n(12),o=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return o.stringify.apply(o,arguments)}},function(e,t){var n=e.exports={version:"2.4.0"};"number"==typeof __e&&(__e=n)},function(e,t){e.exports={title:"User Import / Export",name:"auth0-user-import-export",version:"1.4.4",author:"auth0",description:"This extension allows you to import/export users from/to your account.",type:"application",logoUrl:"https://cdn.rawgit.com/auth0/auth0-user-import-export-extension/master/assets/logo.svg",initialUrlPath:"/login",repository:"https://github.com/auth0/auth0-user-import-export-extension",keywords:["auth0","extension"],auth0:{scopes:"create:users read:users read:connections"}}},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("ejs")},function(e,t){e.exports=require("express-jwt")},function(e,t){e.exports=require("jade")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("lru-cache")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("superagent")},function(e,t){e.exports=require("webtask-tools")}]);